import { HttpFormDataBody, HttpMethodParams } from "../../types/http";
import { PartialBy } from "../../types/utils/partial-by";
import { buildURLParams } from "../../url/url.utils";
import { fetchResponseMapper, httpErrorLogger, streamToJson, toFormData } from "../http.utils";



/**
 * @function httpPutFormData 
 * 
 * send put request with form data body type in browser
 * 
 * @param {object} options 
 * @param {string} options.url - request url
 * @param {object} options.headers - key-value headers to send with the request
 * @param {object} options.params - request url' params
 * @param {object} options.body - js body object sent in body
 * 
 * @returns {Promise} - put response
 */
export function httpPutFormData({ url, headers, params, body }:

    Omit<
        PartialBy<HttpMethodParams, "headers" | "params">,
        "body"
    > & {
        body: HttpFormDataBody
    }

) {
    try {

        let requestParams = buildURLParams(params);
        requestParams = requestParams ? `?${requestParams}` : ``;

        return fetch(
            `${url}${requestParams}`,
            {
                method: 'PUT',
                headers: new Headers({
                    ...headers,
                    'Content-Type': 'multipart/form-data'
                }),
                body: toFormData(body),
            })
            .then(streamToJson)
            .then(fetchResponseMapper);

    } catch (error) {

        httpErrorLogger(error, 'Post');

        throw error;
    }
}