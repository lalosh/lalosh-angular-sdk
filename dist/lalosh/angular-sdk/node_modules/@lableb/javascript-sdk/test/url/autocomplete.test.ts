import { CountryCode, IPAddress } from '../../src/types/url';
import { URLBuilder } from '../../src/url';

describe('Test Generating Autocomplete URLs', () => {

    let options = {
        baseURL: 'https://www.example.com/api/v2',
        collectionName: 'posts',
        projectName: 'wptest',
        indexToken: '38937489374h3jhkahf978a6fhfu',
        searchToken: 'kajlfif8a678a78fh2224jh24fa23',
        searchHandler: 'default',
        autoCompleteHandler: 'suggest',
        recommendHandler: 'default',
    };

    let urlInstance= URLBuilder(options);;


    beforeAll(() => {
        urlInstance = URLBuilder(options);
    });






    test('Correctly generate autocomplete url', () => {

        let autocompleteURL = urlInstance.autocompleteURL();

        let rightAnswer = `${options.baseURL}/projects/${options.projectName}/collections/${options.collectionName}/autocomplete/${options.autoCompleteHandler}?token=${options.searchToken}`;

        expect(autocompleteURL).toBe(rightAnswer);
    });


    test('Correctly generate autocomplete url with params', () => {

        let autocompleteURLOptions = {
            query: 'lableb',
            userId: 2342,
            userCountry: 'AF' as CountryCode,
            userIp: '112.125.233.221' as IPAddress,
            sessionId: 'falijf8379748alfj',
        }

        let autocompleteURL = urlInstance.autocompleteURL(autocompleteURLOptions);

        let rightAnswer = `${options.baseURL}/projects/${options.projectName}/collections/${options.collectionName}/autocomplete/${options.autoCompleteHandler}`;
        rightAnswer += `?q=${autocompleteURLOptions.query}`;
        rightAnswer += `&user_id=${autocompleteURLOptions.userId}`;
        rightAnswer += `&user_country=${autocompleteURLOptions.userCountry}`;
        rightAnswer += `&user_ip=${autocompleteURLOptions.userIp}`;
        rightAnswer += `&session_id=${autocompleteURLOptions.sessionId}`;
        rightAnswer += `&token=${options.searchToken}`;

        expect(autocompleteURL).toBe(rightAnswer);
    });







    test('Correctly generate autocomplete feed back URL', () => {

        let autocompleteFeedbackURL = urlInstance.autocompleteFeedbackURL();

        let rightResult = `${options.baseURL}/projects/${options.projectName}/collections/${options.collectionName}/autocomplete/${options.autoCompleteHandler}/feedback/hits?token=${options.searchToken}`;

        expect(autocompleteFeedbackURL).toBe(rightResult);
    });




    test('Correctly generate autocomplete feed back URL with params', () => {


        let autocompleteFeedbackOptions = {
            query: 'test',
            itemId: 432,
            itemOrder: 2,
            url: 'https://www.example.com/item',
            sessionId: '8972789uafaf',
            userId: 43,
            userIp: '192.168.1.5' as IPAddress,
            userCountry: 'AF' as CountryCode,
           
        }

        let autocompleteFeedbackURL = urlInstance.autocompleteFeedbackURL(autocompleteFeedbackOptions);


        let rightResult = `${options.baseURL}/projects/${options.projectName}/collections/${options.collectionName}/autocomplete/${options.autoCompleteHandler}/feedback/hits`;
        rightResult += `?q=${autocompleteFeedbackOptions.query}`;
        rightResult += `&item_id=${autocompleteFeedbackOptions.itemId}`;
        rightResult += `&item_order=${autocompleteFeedbackOptions.itemOrder}`;
        rightResult += `&url=${autocompleteFeedbackOptions.url}`;
        rightResult += `&session_id=${autocompleteFeedbackOptions.sessionId}`;
        rightResult += `&user_id=${autocompleteFeedbackOptions.userId}`;
        rightResult += `&user_ip=${autocompleteFeedbackOptions.userIp}`;
        rightResult += `&user_country=${autocompleteFeedbackOptions.userCountry}`;
        rightResult += `&token=${options.searchToken}`;

        expect(autocompleteFeedbackURL).toBe(rightResult);
    });





});