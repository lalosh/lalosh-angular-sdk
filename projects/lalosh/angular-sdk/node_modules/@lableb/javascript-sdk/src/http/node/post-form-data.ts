import axios from "axios";
import { HttpFormDataBody, HttpMethodParams } from "../../types/http";
import { PartialBy } from "../../types/utils/partial-by";
import { axiosResponseMapper, httpErrorLogger, toFormData } from "../http.utils";


/**
 * @function httpPostFormData 
 * 
 * send post request with form data body type in browser
 * 
 * @param {object} options 
 * @param {string} options.url - request url
 * @param {object} options.headers - key-value headers to send with the request
 * @param {object} options.params - request url' params
 * @param {object} options.body - js body object sent in body
 * 
 * @returns {Promise} - post response
 */
export function httpPostFormData(

    { url, headers, params, body }:

        /**
         * replace the normal body with the form data type for body
         */
        Omit<
            PartialBy<HttpMethodParams, "params" | "headers">,
            "body"
        >
        & {
            body: HttpFormDataBody
        }

) {
    try {

        return axios.post(
            url,
            toFormData(body),
            {
                headers: {
                    ...headers,
                    'Content-Type': 'multipart/form-data'
                },
                params
            })
            .then(axiosResponseMapper);

    } catch (error) {
        
        httpErrorLogger(error, 'Post');

        throw error;
    }
}